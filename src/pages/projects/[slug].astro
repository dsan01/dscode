---
import ContactBanner from '@generics/ContactBanner.astro'
import ProjectContent from '@sections/projects/ProjectContent.astro'
import ProjectHeader from '@sections/projects/ProjectHeader.astro'
import Layout from 'src/layouts/Layout.astro'
import fetchApi from '@lib/strapi'
import type { ProjectType } from '@data/data'

import { getLangFromUrl, useTranslations } from 'src/i18n/utils'

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)

const { slug } = Astro.params

let project: ProjectType

try {
  project = await fetchApi<ProjectType>({
    endpoint: 'projects?populate=thumbnail',
    wrappedByKey: 'data',
    wrappedByList: true,
    lang: lang,
    query: {
      'filters[slug][$eq]': slug || '',
    },
  })
  if (!project) {
    return Astro.redirect('/404')
  }
} catch (error) {
  return Astro.redirect('/404')
}
---

<Layout>
  <ProjectHeader project={project} />
  {project.content && <ProjectContent content={project.content} />}
  <ContactBanner
    title={'index.contactBanner.title'}
    showDesc={false}
  />
</Layout>
